function ajaxReq(t,a="GET",e,i=null,r=null,l="null"){$.ajaxSetup({headers:{"X-CSRF-Token":$("meta[name=csrf-token]").attr("content")}}),$.ajax({url:t,data:i,type:a,contentType:!1,cache:!1,processData:!1,beforeSend:function(){null!=r&&r()},success:function(t){e(t)},error:function(t){if(console.log(t),"null"===l)console.log(t);else if("window.alert"===l){let a;$.each(t.responseJSON.errors,function(t,e){a+=e[0]}),alert(a)}else $("#"+l).removeClass("d-none"),$.each(t.responseJSON.errors,function(t,a){$("#"+l).append(a[0]+"<br>")})}})}function translit(t){var a="",e={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"ye","ё":"yo","ж":"zh","з":"z","и":"ee","й":"i","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"kh","ц":"ts","ч":"ch","ш":"sh","щ":"shs","ъ":"-","ы":"ii","ь":"=","э":"e","ю":"yu","я":"ya"};""!=t&&(t=t.toLowerCase());for(var i=0;i<t.length;i++)/[а-яё]/.test(t.charAt(i))?a+=e[t.charAt(i)]:/[a-z0-9]/.test(t.charAt(i))?a+=t.charAt(i):"-"!==a.slice(-1)&&(a+="-");return a}function transliter(t){for(var a="",e={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"iy","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"kh","ц":"s","ч":"ch","ш":"sh","щ":"sh","ъ":"","ы":"y","ь":"`","э":"e","ю":"yu","я":"ya","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"YO","Ж":"ZH","З":"Z","И":"I","Й":"j","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"KH","Ц":"C","Ч":"CH","Ш":"SH","Щ":"SH","Ъ":"","Ы":"I","Ь":"`","Э":"E","Ю":"YU","Я":"YA"},i=0;i<t.length;i++)/[а-яё]/.test(t.charAt(i))?a+=e[t.charAt(i)]:/[А-ЯЁ]/.test(t.charAt(i))?a+=e[t.charAt(i)]:/[a-z]/.test(t.charAt(i))?a+=t.charAt(i):(/[A-Z0-9]/.test(t.charAt(i)),a+=t.charAt(i));return a}function printError(t){return' <div class="alert alert-icon alert-danger alert-dismissible in" role="alert" style=""><button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">×</span></button> <i class="fa fa-exclamation-triangle" style="margin-right:10px;"></i>'+t+"</div>"}function remoGalleryFromTemp(t){form_data=new FormData,form_data.append("image",galleries[t-1]),ajaxReq("/admin/gallery/unlink/fromTemp","Post",a=>{galleries[t-1]="",$("#form_galleries #mgal_"+t).remove()},form_data)}function removeGallery(t){ajaxReq("/admin/gallery/"+t,"Get",a=>{$("#form_photo #gal_"+t).remove()})}$(document).on("keyup","#title_ru",function(t){t.preventDefault(),$("#slug").val(translit($(this).val()))}),$(document).on("click","#change_checkbox",function(t){t.preventDefault(),clas=$(this).attr("data-class"),id=$(this).attr("data-id"),route="/admin/"+clas+"/"+id+"/active",console.log(route),ajaxReq(route,"Get",t=>{0==t?($(this).prop("checked",!1),$("#active_"+clas+"_"+id+" .text").html("Нет")):1==t&&($(this).prop("checked",!0),$("#active_"+clas+"_"+id+" .text").html("Да"))})}),galleries=[],$(document).on("click","#upload",function(){image=$("#gallery").val(),$(this).html("Загрузка..."),""!=image?(form_data=new FormData,console.log(image),form_data.append("image",$("#gallery").prop("files")[0]),ajaxReq("/admin/gallery/upload/toTemp","Post",t=>{galleries.push(t.img),$("#form_galleries").append('<div style="margin:10px;" id="mgal_'+galleries.length+'"><img src="/public/temp/'+t.img+'" width="100" alt=""><a style="display: block; text-align: center; font-size: 15px;  color: #FF0000; margin: 10px;" href="javascript:remoGalleryFromTemp('+galleries.length+')"><i class="fas fa-trash"></i></a></div>'),$("#gallery").val(""),$(".dropify-preview").attr("style","dispaly:none"),$(this).html("Загрузить")},form_data)):$(this).html("Загрузить")}),$(document).on("click","#submit_photo",function(){$(this).html("Отправка..."),date=$("#form_photo #date").val(),title_ru=$("#form_photo #title_ru").val(),title_tj=$("#form_photo #title_tj").val(),title_en=$("#form_photo #title_en").val(),slug=$("#form_photo #slug").val(),image=""!=$("#form_photo #image").val()?$("#form_photo #image").prop("files")[0]:"",text_ru=$("#form_photo #text_ru").val(),text_tj=$("#form_photo #text_tj").val(),text_en=$("#form_photo #text_en").val(),form_data=new FormData,form_data.append("date",date),form_data.append("title_ru",title_ru),form_data.append("title_tj",title_tj),form_data.append("title_en",title_en),form_data.append("slug",slug),form_data.append("text_tj",text_tj),form_data.append("text_ru",text_ru),form_data.append("text_en",text_en),form_data.append("image",image),form_data.append("galleries",galleries),ajaxReq("/admin/photogallery/store","Post",t=>{if(1==t.err)return $("#form_photo #error").html(printError(t.msg)),$(this).html("Сохранить"),void window.scrollTo(0,0);0==t.err&&(window.location="/admin/photogalleries")},form_data)}),$(document).on("click","#upload_update",function(){form_data=new FormData,image=""!=$("#form_photo #gallery").val()?$("#form_photo #gallery").prop("files")[0]:"",""!=image&&($(this).html("Загрузка..."),form_data.append("image",image),ajaxReq("/admin/upload/gallery/toPhoto/"+$(this).attr("data-id"),"Post",t=>{$("#form_galleries").append('<div style="margin:10px;" id="mgal_'+t.id+'"><img src="/public/uploads/galleries/'+t.img+'" width="100" height="100"  alt=""><a style="display: block; text-align: center; font-size: 15px;  color: #FF0000; margin: 10px;" href="javascript:removeGallery('+t.id+')"><i class="fas fa-trash"></i></a></div>'),$("#gallery").val(""),$(".dropify-preview").attr("style","dispaly:none"),$(this).html("Загрузить")},form_data))}),$(document).on("click","#submit_ministry",function(){$(this).html("Отправка..."),title_ru=$("#add_modal_ministry #title_ru").val(),title_tj=$("#add_modal_ministry #title_tj").val(),title_en=$("#add_modal_ministry #title_en").val(),""!=title_ru?(form_data=new FormData,form_data.append("title_tj",title_tj),form_data.append("title_ru",title_ru),form_data.append("title_en",title_en),ajaxReq("/admin/ministry/store","Post",t=>{location.reload()},form_data)):$("#add_modal_ministry #error").html(printError("Введите заголовок* (RU)"))}),$(document).on("click","#edit_ministry",function(t){t.preventDefault(),id=$(this).attr("data-id"),ajaxReq("/admin/ministry/edit/"+id,"Get",t=>{$("#modal_ministry #myLargeModalLabel").html("Обнoвить министерство "),$("#modal_ministry .modal-body .card-body").html(t.html),$("#modal_ministry").modal("show")})}),$(document).on("click","#update_ministry",function(){$(this).html("Отправка..."),title_ru=$("#modal_ministry #title_ru").val(),title_tj=$("#modal_ministry #title_tj").val(),title_en=$("#modal_ministry #title_en").val(),""!=title_ru?(form_data=new FormData,form_data.append("title_tj",title_tj),form_data.append("title_ru",title_ru),form_data.append("title_en",title_en),id=$(this).attr("data-id"),ajaxReq("/admin/ministry/update/"+id,"Post",t=>{location.reload()},form_data)):$("#modal_ministry #error").html(printError("Введите заголовок* (RU)"))}),$(document).on("click","#submit_category",function(){if($(this).html("Отправка..."),title_ru=$("#add_modal_ministry #title_ru").val(),title_tj=$("#add_modal_ministry #title_tj").val(),title_en=$("#add_modal_ministry #title_en").val(),slug=$("#add_modal_ministry #slug").val(),image=$("#add_modal_ministry #image").val(),""==title_ru)return $("#add_modal_ministry #error").html(printError("Введите заголовок* (RU)")),void $(this).html("Добавить");form_data=new FormData,form_data.append("title_tj",title_tj),form_data.append("title_ru",title_ru),form_data.append("title_en",title_en),form_data.append("slug",slug),""!=image&&form_data.append("image",$("#add_modal_ministry #image").prop("files")[0]),ajaxReq("/admin/category/store","Post",t=>{1==t.err?$("#add_modal_ministry #error").html(printError(t.msg)):location.reload()},form_data)}),$(document).on("click","#edit_category",function(t){t.preventDefault(),id=$(this).attr("data-id"),ajaxReq("/admin/category/edit/"+id,"Get",t=>{$("#modal_ministry #myLargeModalLabel").html("Обнoвить категрия "),$("#modal_ministry .modal-body .card-body").html(t.html),$("#modal_ministry").modal("show")})}),$(document).on("click","#update_category",function(){if($(this).html("Отправка..."),title_ru=$("#modal_ministry #title_ru").val(),title_tj=$("#modal_ministry #title_tj").val(),title_en=$("#modal_ministry #title_en").val(),slug=$("#modal_ministry #slug").val(),image=$("#modal_ministry #image").val(),""==title_ru)return $("#modal_ministry #error").html(printError("Введите заголовок* (RU)")),Сохранить,void $(this).html("Сохранить");form_data=new FormData,form_data.append("title_tj",title_tj),form_data.append("title_ru",title_ru),form_data.append("title_en",title_en),form_data.append("slug",slug),""!=image&&form_data.append("image",$("#modal_ministry #image").prop("files")[0]),id=$(this).attr("data-id"),ajaxReq("/admin/category/update/"+id,"Post",t=>{1==t.err?$("#modal_ministry #error").html(printError(t.msg)):location.reload()},form_data)});
